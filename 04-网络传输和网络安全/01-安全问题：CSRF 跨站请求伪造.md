
## 前言

前端面试中的安全问题，明确来说，就两个方面：

- CSRF：基本概念、攻击原理、防御措施。

- XSS：基本概念、攻击原理、防御措施。

这两个问题，不会问太难。如果把**攻击原理**和**防御措施**掌握好，基本没什么问题。

有人问：SQL注入算吗？答案：这个其实跟前端的关系不大。


## CSRF的基本概念、缩写、全称

CSRF（Cross-site request forgery）：**跨站请求伪造**。

PS：缩写和中文名一定要记住。英文全称，如果记不住也拉倒。


## CSRF的攻击原理

![](https://img.smyhvae.com/20180307_1735.png)

攻击原理：

（1）用户是授信网站A的注册用户，访问网站并登录成功后（确认身份），于是网站A就给用户下发cookie。

（2）谨记着着，用户**被诱导**打开钓鱼网站B，网站B以用户身份发起**伪造用户操作**的接口请求，达到攻击目的。

（3）后端以为是用户在操作，从而执行相应的业务逻辑。

从上图可以看出，要完成一次CSRF攻击，受害者必须满足两个必要的条件：

（1）登录受信任网站A，并在本地生成Cookie。（如果用户没有登录网站A，那么网站B在诱导的时候，请求网站A的api接口时，会提示你登录）

（2）在不登出A的情况下，访问危险网站B（其实是利用了网站A的漏洞）。

我们在讲CSRF时，一定要把上面的两点说清楚。

温馨提示一下，cookie保证了用户可以处于登录状态，但网站B其实拿不到 cookie。

举例1：曾经有段时间里，微博网站有个api接口有漏洞，导致很多用户的粉丝暴增。

举例2：用户同时打开了A网站和钓鱼网站。 假设A网站中有一个通过 GET 请求提交用户评论的接口，那么攻击者就可以在钓鱼网站中加入一个图片，图片的地址就是评论接口：

```html
<img src="http://www.domain.com/xxx?comment='attack'"/>
```

## CSRF如何防御

### 方法1、使用post 请求

使用post请求之后，需要服务端做跨域的配置，才能请求接口。此时，CSRF的`<image>`等方式是无法攻击的。

如果使用 get 请求，建议不对数据进行修改。

### 方法2、Token 验证（用的最多）

（1）服务器给前端发送一个token。

（2）前端请求接口时中带着这个token。

（3）服务端对 token 做校验，如果这个 token 不合法，那么服务器拒绝这个请求。

### 方法3：隐藏令牌

把 token 隐藏在 http 的 head 头中。

方法3和方法2有点像，本质上没有太大区别，只是使用方式上有区别。

### 方法4、Referer 验证

Referer 指的是页面请求来源。意思是，**只接受本站的请求，服务器才做响应**；如果不是，就拦截。

### 方法5、其他的安全校验

比如短信验证码、指纹、支付密码等。

## 参考链接

- [CSRF攻击](https://fecommunity.github.io/front-end-interview/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/Web%E5%AE%89%E5%85%A8/2.CSRF%E6%94%BB%E5%87%BB.html)

- [CSRF 攻击 · 服务端面试知识整理](http://jalan.space/interview/network/security/csrf.html)

