## 前言

性能优化是必考的综合性问题，主要考察你的知识面是否够广。问的过程中，可能会单独问一些细节问题：比如防抖节流、大列表渲染等等。

## 性能优化的总体原则

- 多使用缓存、多使用内存。

- 减少CPU计算量，减少网络请求耗时。

上面两条原则，适用于所有编程的性能优化：用空间换时间。

具体到前端领域，性能优化分为加载阶段和渲染阶段。

## 一、加载阶段

1、减少资源体积：代码逻辑优化（避免写重复代码）、压缩代码、压缩图片&字体等静态资源（建议使用动态字体）、tree shaking 去掉多余代码&重复代码。

2、减少访问次数：合并代码；减少http请求数量（比如CSS雪碧图）；多使用缓存，避免重复请求。其它补充回答：SSR服务端渲染、PWA。

3、非核心代码**异步**加载。

4、使用 CDN。静态资源全部放CDN上，使用户可就近获取所需内容，网络更快，大幅减小光纤传输距离。

5、dns预解析：使用dns-prefetch 提前解析域名，提高资源加载速度。在访问以图片为主的网站时，DNS预解析可以让加载时间减少5%左右。

6、避免301、302 重定向：重定向会降低响应速度。

## 二、渲染阶段

1、CSS放在`<head>` 里，尽早渲染样式；JS放在`<body>`内的最下方，避免阻塞 DOM 的解析。

2、尽早开始执行 JS逻辑代码，用 DOMContentLoaded 触发。

3、不要频繁操作DOM，可以合并到一起，再一次插入DOM结构。

4、减少浏览器的重绘和重排。

5、图片懒加载。

6、对DOM查询进行缓存。

7、防抖节流。

8、骨架屏 skeleton：减少布局移动

9、无限滚动列表：做节点回收

## 三、性能分析和诊断工具

- 控制台的 performance工具：在开发过程中分析页面运行时的性能表现。

- 控制台的 LightHouse ：跑分、输出性能报告，分析性能。

- Performance 这个API：可以在代码里测量性能。

- 控制台的瀑布图 Waterfall。

- [WebPageTest](https://www.webpagetest.org)网站：评估网站性能。


---